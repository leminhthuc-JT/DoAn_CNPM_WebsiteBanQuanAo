@{
    ViewBag.Title = "Xác thực Email";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="~/Content/Css/VerifyOTP.css" rel="stylesheet" />

<div class="otp-wrapper">

    <div class="otp-title">Xác nhận Email</div>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success text-center">@TempData["Success"]</div>
    }

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger text-center">@TempData["Error"]</div>
    }

    <p class="text-center text-muted mb-4">
        Mã OTP đã được gửi đến email của bạn.<br />
        Vui lòng kiểm tra hộp thư và nhập mã bên dưới.
    </p>

    @using (Html.BeginForm("VerifyOTP", "Account", FormMethod.Post))
    {
        <div class="mb-3">
            <label class="form-label">Mã OTP</label>
            <input type="text" name="otp" class="form-control text-center fs-4 fw-bold" maxlength="6" required placeholder="••••••" />
        </div>

        <button class="btn btn-verify w-100 py-2">Xác nhận</button>

        if (ViewBag.Error != null)
        {
            <p class="text-danger text-center mt-3 fw-bold">@ViewBag.Error</p>
        }
    }

    <div class="text-center mt-3">

        @using (Html.BeginForm("ResendOTP", "Account", FormMethod.Post))
        {
            <button type="submit" id="resendBtn" class="resend btn btn-link p-0" style="text-decoration:none;">
                Gửi lại mã OTP
            </button>
        }

        <p id="countdown" class="text-muted mt-2" style="display:none;"></p>
    </div>
</div>
<script>
    let timeLeft = 60;

    function startCountdown() {
        $("#resendBtn").prop("disabled", true).css("color", "#aaa");
        $("#countdown").show();

        let timer = setInterval(function () {
            timeLeft--;
            $("#countdown").text("Bạn có thể gửi lại sau " + timeLeft + " giây");

            if (timeLeft <= 0) {
                clearInterval(timer);
                $("#resendBtn").prop("disabled", false).css("color", "#4e4376");
                $("#countdown").hide();
            }
        }, 1000);
    }

    //Tự kích hoạt đếm ngược nếu vừa bấm resend
    @if (TempData["Success"] != null)
    {
        @:startCountdown();
    }
</script>
